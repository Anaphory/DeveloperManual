%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Journal Article
% LaTeX Template
% Version 1.4 (15/5/16)
%
% This template has been downloaded from:
% http://www.LaTeXTemplates.com
%
% Original author:
% Frits Wenneker (http://www.howtotex.com) with extensive modifications by
% Vel (vel@LaTeXTemplates.com) and Fabio Mendes (f.mendes@auckland.ac.nz)
%
% License:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%	PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

%\documentclass[oneside,twocolumn]{article}
\documentclass[oneside]{article}

\usepackage{blindtext} % Package to generate dummy text throughout this template 

\usepackage{graphicx} % FKM: for figures
\usepackage{color} % FKM: for colored text
\usepackage{float} % FKM: for forcing figure placement
\usepackage[breakable]{tcolorbox} % FKM: for text box
\usepackage{enumerate} % FKM: for bullet point lists
\usepackage{setspace} % FKM: line spacing
\usepackage[margin=1in]{geometry} % FKM: margins
\usepackage{listings} % FKM: for code windows (lstlisting)
\usepackage{tikz} % FKM: using for \checkmark
\def\checkmark{\tikz\fill[scale=0.4](0,.35) -- (.25,0) -- (1,.7) -- (.25,.15) -- cycle;}

\usepackage[sc]{mathpazo} % Use the Palatino font
\usepackage[T1]{fontenc} % Use 8-bit encoding that has 256 glyphs
% \linespread{1.05} % Line spacing - Palatino needs more space between lines
\usepackage{microtype} % Slightly tweak font spacing for aestheticsgins
\usepackage[small,labelfont=bf,up,up]{caption} % Custom captions under/above floats in tables or figures
\usepackage{booktabs} % Horizontal rules in tables
\usepackage{amsmath} % Text in equations

\usepackage[shortlabels]{enumitem} % customized lists (shortlabels
                                % necessary to have i., ii., etc., in enumerate)
\setlist[itemize]{noitemsep} % Make itemize lists more compact

\usepackage{abstract} % Allows abstract customization
\renewcommand{\abstractnamefont}{\normalfont\bfseries} % Set the "Abstract" text to bold
\renewcommand{\abstracttextfont}{\normalfont\small\itshape} % Set the abstract itself to small italic text

\usepackage{titlesec} % Allows customization of titles

\usepackage{fancyhdr} % Headers and footers
\pagestyle{fancy} % All pages have headers and footers
\fancyhead{} % Blank out the default header
\fancyfoot{} % Blank out the default footer
\fancyhead[C]{Authors et al. $\bullet$ August 2018 $\bullet$ bio{\color{red}R}$\chi$ve} % Custom header text
\fancyfoot[RO,LE]{\thepage} % Custom footer text

\usepackage{titling} % Customizing the title section

\usepackage[hidelinks]{hyperref} % For hyperlinks in the PDF

\usepackage{natbib}
\bibliographystyle{apalike}

\setlength\columnsep{20pt}

\definecolor{pblue}{rgb}{0.13,0.13,1}
\definecolor{pgreen}{rgb}{0,0.5,0}
\definecolor{pred}{rgb}{0.9,0,0}
\definecolor{pgrey}{rgb}{0.46,0.45,0.48}
\definecolor{maroon}{rgb}{0.5,0,0}
\definecolor{darkgreen}{rgb}{0,0.5,0}

\lstset{language=Java,
  showspaces=false,
  showtabs=false,
  breaklines=true,
  showstringspaces=false,
  breakatwhitespace=true,
  commentstyle=\color{pgreen},
  keywordstyle=\color{pblue},
  stringstyle=\color{pred},
  basicstyle=\ttfamily,
  moredelim=[il][\textcolor{pgrey}]{$$},
  moredelim=[is][\textcolor{pgrey}]{\%\%}{\%\%}
}


\lstdefinelanguage{XML}
{
  basicstyle=\ttfamily,
  morestring=[s]{"}{"},
  morecomment=[s]{?}{?},
  morecomment=[s]{!--}{--},
  commentstyle=\color{darkgreen},
  moredelim=[s][\color{black}]{>}{<},
  moredelim=[s][\color{red}]{\ }{=},
  stringstyle=\color{black},
  keywordstyle=\color{black},
  identifierstyle=\color{blue}
}

%----------------------------------------------------------------------------------------
%	TITLE SECTION
%----------------------------------------------------------------------------------------

\setlength{\droptitle}{-4\baselineskip} % Move the title up

\pretitle{\begin{center}\Huge\bfseries} % Article title formatting
\posttitle{\end{center}} % Article title closing formatting
\title{{\huge SUPPLEMENTARY MATERIAL}\\\vspace{.5cm}How to validate your probabilistic model
  implementation} % Article title
\author{\textsc{An author here$^{1,2*}$}, \textsc{Another author
    here$^{1*}$}, \\ \textsc{Yet another author here$^{1*}$},
  \textsc{Last author here$^{1*}$} \\
\small $^1$School of Computer Science, The University of Auckland\\
\small $^2$School of Biological Sciences, The University of Auckland\\
\small
\href{mailto:f.mendes@auckland.ac.nz}{Corresponding authors$^*$: f.mendes@auckland.ac.nz,}
\href{mailto:f.mendes@auckland.ac.nz}{another.email@auckland.ac.nz}
%\and % Uncomment if 2 authors are required, duplicate these 4 lines if more
%\textsc{Jane Smith}\thanks{Corresponding author} \\[1ex] % Second author's name
%\normalsize University of Utah \\ % Second author's institution
%\normalsize \href{mailto:jane@smith.com}{jane@smith.com} % Second author's email address
}
\date{\today} % Leave empty to omit a date
% \renewcommand{\maketitlehookd}{}

%----------------------------------------------------------------------------------------

\doublespacing

\begin{document}

% Print the title
\maketitle

\clearpage
%----------------------------------------------------------------------------------------
%	ARTICLE CONTENTS
%----------------------------------------------------------------------------------------

\section*{Validation procedures in the literature}

The literature on probabilistic modelling in evolutionary biology is vast,
and an exhaustive review of this literature is outside the
scope of the present work. 
We do however provide an extensive list of references that
have implemented (and potentially validated) phylogenetic Bayesian
models (Table \ref{tab:papers}) and other inference components such as
operators.
Each reference was annotated for different validation categories (these
are discussed in the main text).
Our goal was to capture the variation in validation stringency and
comprehensiveness present in this set of computational tools.

We listed references implementing models from the ground
up, meaning that ideally some validation should have been reported in
the manuscript or appendix.
A reference was annotated as having conducted a particular correctness
test if it explicitly mentioned the procedure in the main or
supplementary text, and annotated as ``N/A'' if no validation was mentioned.
Note that ``N/A'' does not mean that validation did not took place,
only that it was not mentioned in the text.
We would hope that unit tests for the likelihood function (item ``i''
in Tab. \ref{tab:papers}), for example, have been implemented in most
if not all of the software we listed.
Alternatively, a reference might belong to a group of several
publications collectively documenting the development of a large
software package, in which case previous work could have documented 
the validation of at least part of the Bayesian inference machinery,
such as MCMC operators.

\begin{center}
  \begin{table}
  \caption{A non-exhaustive list of references from the Bayesian
    phylogenetics literature and the validation procedures explicitly
    mentioned in the main or supplementary text. When no validation
    was mentioned, a reference was annotated as ``N/A''.}
  \label{tab:papers}
  \centering
  \begin{tabular}{ l|c|c|c|c|c|c }
    \hline
    Reference & N/A & i & ii & iii & iv & (a) \\
    \hline
    \citealp{yang97} & & \checkmark & & & & \\
    \citealp{mau99} & & & & \checkmark & & \\
    \citealp{huelsenbeck00} & & & & & & \\
    \citealp{drummond02} & & & \checkmark & & & \checkmark \\
    \citealp{pybus03} & & & & & & \\
    \citealp{lunter03} & & & & & & \\
    \citealp{drummond05} & & & & & & \\
    \citealp{drummond06} & & & & & & \\
    \citealp{best07} & & & & & & \\
    \citealp{than08} & & & & & & \\
    \citealp{heled08} & & & & & & \\
    \citealp{drummond08} & & & & & & \\
    \citealp{lemey09} & & & & & & \\
    \citealp{heled10} & & & & & & \\
    \citealp{drummond10} & & & & & & \\
    \citealp{wu11} & & & & & & \\
    \citealp{liu11} & & & & \checkmark & & \\
    \citealp{eastman11} & & & & \checkmark & & \\
    \citealp{stadler12} & & & & & & \\
    \citealp{heath12a} & & & & & & \\
    \citealp{heath12b} & & & & & & \\
    \citealp{li12} & & & & & & \\
    \citealp{hohna12} & & & & & & \\
    \citealp{heled12} & & & & & & \\
    \citealp{wu13} & & & & & & \\
    \citealp{stadler13} & & & & & & \\
    \citealp{landis13a} & & & & & & \\
    \citealp{landis13b} & & & & & & \\
    \citealp{vaughan14} & & & & & & \\
    \citealp{kuhnert14} & & & & & & \\
    \citealp{gavryushkina14} & & & & & & \\
    \citealp{heath14} & & & & & & \\
    \citealp{popinga15} & & & & & & \\
    \citealp{heled15} & & & & & & \\
    \citealp{uyeda14} & & & & \checkmark & & \\
    \citealp{kuhnert16} & & & & & & \\
    \citealp{kostikova16} & & & & \checkmark & & \\
    \citealp{vaughan17} & & & & & & \\
    \citealp{ogilvie17} & & & & & & \\
    \citealp{bouckaert17} & & & & & \checkmark & \\
    \citealp{zhang17} & & & & & & \\
    \citealp{caetano17} & & & & & & \\
    \citealp{carretero18} & & & & & & \\
    \citealp{du18} & & & & \checkmark & & \\
    \citealp{silvestro19} & & & & \checkmark & & \\
    \hline
  \end{tabular}
  \end{table}
\end{center}

\section*{Validation examples}
Below we provide code examples for the validation procedures mentioned
in the main text.
The code excerpts are written in Java or xml, as they use BEAST 2
model implementations as the reference software being validated.

\subsection*{Computing the likelihood and comparing against an expected value}

The simplest validation test for a likelihood implementation is to
evaluate the likelihood of a parameter value given some
data, and then compare it to some expected value.
Ideally, the expected value will have been analytically derived from the
model under simple conditions (e.g., a small phylogenetic tree while
equating some of the parameters to zero or unity, etc.).
This forms the basis of what software engineers refer to as ``unit testing''.
We show a unit test example for the Yule model in listing \ref{lst:yuleunit}.

{\small
\singlespacing
\begin{lstlisting}[language=Java, caption=Java unit test for Yule model
  likelihood function given a small phylogenetic tree.,label={lst:yuleunit}]
  
package test;

import org.junit.Test;
import beast.evolution.speciation.YuleModel;
import beast.util.TreeParser;
import junit.framework.TestCase;

public class YuleLikelihoodTest extends TestCase {
    @Test
    public void testYuleLikelihood() {
        TreeParser tree = new TreeParser("((A:1.0,B:1.0):1.0,(C:1.0,D:1.0):1.0);");
        YuleModel likelihood = new YuleModel();
        likelihood.initByName("tree", tree, "birthDiffRate", "1.0");

        assertEquals(-6.0, likelihood.calculateLogP());
    }
}
\end{lstlisting}
}

As discussed in the main text, another possibility is to use MCMC to
sample from the model without data, and evaluate the resulting
distribution with respect to some analytically derived summary
statistic.
If such quantity has not been derived, one can compare the
distribution sampled with MCMC with a distribution obtained through
direct simulation (i.e., from $S(M)$).
Below, we provide an \texttt{.xml} BEAST 2 control file that carries
out the latter procedure for the Yule model:

{\small
\singlespacing
\begin{lstlisting}[language=XML, caption=BEAST 2 control file for
  generating two distributions under the Yule model (one obtained by
  sampling through MCMC and the other with direct simulation)., label={lst:yuleunit}]
  
  <beast version="2.0" namespace="beast.core:
  beast.evolution.alignment:
  beast.evolution.tree:
  beast.math.distributions:
  beast.evolution.speciation:
  beast.core.util:beast.core.parameter">

  <run spec="MCMC" chainLength="1000000">
    <state id="state">
      <stateNode idref="tree"/>
      <stateNode idref="birthDiffRateParam"/>
    </state>

    <distribution spec="CompoundDistribution" id="fullModel">
      <distribution spec="YuleModel" id="yuleModel">
        <tree spec="Tree" id="tree">
          <taxonset spec="TaxonSet">
            <taxon spec="Taxon" id="t1"/>
            <taxon spec="Taxon" id="t2"/>
            <taxon spec="Taxon" id="t3"/>
            <taxon spec="Taxon" id="t4"/>
            <taxon spec="Taxon" id="t5"/>
          </taxonset>
        </tree>

        <birthDiffRate spec="RealParameter" id="birthDiffRateParam" value="1.0"/>
      </distribution>

      <distribution spec="beast.math.distributions.Prior" id="birthDiffRatePrior">
        <distr spec="Exponential" id="xExpParamDist" mean="1"/>
        <x idref="birthDiffRateParam"/>
      </distribution>
    </distribution>

    <operator spec="beast.experimenter.DirectSimulatorOperator" weight="1" state="@state">
      <simulator id="DirectSimulator" spec="beast.core.DirectSimulator" nSamples="1">
        <distribution idref="fullModel"/>
      </simulator>
    </operator>

    <logger id="tracelog" logEvery="1000" fileName="$(filebase).log">
      <log idref="birthDiffRateParam"/>
      <log id="clockRate" spec="beast.util.Script" expression="0.5/TreeHeight">
        <x id="TreeHeight" spec="beast.evolution.tree.TreeHeightLogger" tree="@tree"/>
      </log>
      <log idref="TreeHeight"/>
    </logger>

    <logger id="treelog" logEvery="1000" fileName="$(filebase).trees">
      <log idref="tree"/>
    </logger>

    <logger id="screenlog" logEvery="1000">
      <log idref="birthDiffRateParam"/>
    </logger>
  </run>
</beast>
\end{lstlisting}
}

\subsubsection{Sanity checks when validating a model}



(we point the interested reader to {\color{red}{non-wiki citations here}} for derivations of equations 6)

%----------------------------------------------------------------------------------------
%	REFERENCE LIST
%----------------------------------------------------------------------------------------

\section*{References}
\clearpage

\bibliography{refs}

%----------------------------------------------------------------------------------------

\end{document}
